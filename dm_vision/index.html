<html>
<head></head>
<body>
    <h1>DEATHMATCH VISION</h1>
    <div id="game_list">
        
    </div>
    <script id="game_template" type="text/x-custom-template" data-game="">
        <div class="game">
            <a href="" class="game_link">
                <h2 class="game_server"></h2>
            </a>
                <div class="game_players">

                </div>
        </div>
    </script>
    <script id="player_template" type="text/x-custom-template">
        <div class="player" player-data="">
            <b class="player_name"></b>
        </div>
    </script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>
    <script>
        jQuery.getJSON('http://starblast.io/rankings.json', function (rankings) {
            jQuery.getJSON('http://starblast.io/simstatus.json', function (data) {
                data.forEach(function (value, index) {
                    if (value.location == "America") {
                        value.systems.forEach(function (value, index) {
                            if (value.mode == "deathmatch") {
                                addGame(value, rankings.ratings.America);
                            }
                        });
                    }
                });
            })
        });


        function addGame(game,rankings) {
            var template = $("#game_template").text();
            var $tempalte = $(template);
            $tempalte.find(".game_link").attr("href", 'http://starblast.io/#' + game.id);
            $tempalte.find(".game_server").text(game.name);
            $tempalte.attr("data-game",game.id);
            game.players_list.forEach(function (value, index) {
                ranked = rankings.filter(function (player) {
                    return player.id == value;
                })[0];
                var p_template = $("#player_template").text();
                var $p_template = $(p_template);
                $p_template.find(".player_name").text(ranked.name);
                $tempalte.find(".game_players").append($p_template);
            });
            var $el = $("#game_list .game[data-game=" + game.id + "]");
            if (!$el.length) {
                $("#game_list").append($tempalte);
            } else {
                $el.replaceWith($tempalte);
            }
        }
    </script>
</body>
</html>